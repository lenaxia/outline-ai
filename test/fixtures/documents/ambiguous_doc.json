{
  "id": "doc-ambiguous-mobile-api-001",
  "collectionId": "col-inbox-001",
  "title": "Mobile App API Documentation",
  "text": "# Mobile App API Documentation\n\n## Overview\n\nThis document describes the API endpoints used by our mobile application for iOS and Android platforms. These endpoints handle user authentication, data synchronization, and real-time notifications.\n\n## Base URL\n\n```\nProduction: https://api.mobile.example.com/v2\nStaging: https://api-staging.mobile.example.com/v2\n```\n\n## Authentication\n\nThe mobile app uses OAuth 2.0 for authentication with refresh tokens.\n\n### Login Flow\n\n1. User enters credentials in app\n2. App sends POST to `/auth/login`\n3. Server returns access token (valid 1 hour) and refresh token (valid 30 days)\n4. App stores tokens securely in keychain/keystore\n\n### Endpoints\n\n**POST /auth/login**\n\nRequest:\n```json\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"secure_password\",\n  \"device_id\": \"abc123\"\n}\n```\n\nResponse:\n```json\n{\n  \"access_token\": \"eyJhbGc...\",\n  \"refresh_token\": \"eyJhbGc...\",\n  \"expires_in\": 3600,\n  \"user\": {\n    \"id\": \"user_123\",\n    \"name\": \"John Doe\",\n    \"email\": \"user@example.com\"\n  }\n}\n```\n\n## Data Sync\n\nThe mobile app syncs data in the background using a delta sync approach to minimize bandwidth.\n\n### GET /sync/delta\n\nFetch changes since last sync:\n\n```http\nGET /sync/delta?since=2024-01-20T10:30:00Z\nAuthorization: Bearer {access_token}\n```\n\nResponse:\n```json\n{\n  \"changes\": [\n    {\n      \"type\": \"document\",\n      \"action\": \"created\",\n      \"id\": \"doc_456\",\n      \"data\": {...}\n    },\n    {\n      \"type\": \"document\",\n      \"action\": \"updated\",\n      \"id\": \"doc_123\",\n      \"data\": {...}\n    }\n  ],\n  \"next_sync_token\": \"2024-01-20T11:00:00Z\"\n}\n```\n\n### POST /sync/push\n\nUpload local changes:\n\n```json\n{\n  \"changes\": [\n    {\n      \"type\": \"document\",\n      \"action\": \"updated\",\n      \"id\": \"doc_789\",\n      \"data\": {...},\n      \"local_timestamp\": \"2024-01-20T10:45:00Z\"\n    }\n  ]\n}\n```\n\n## Push Notifications\n\nMobile app receives push notifications for real-time updates.\n\n### POST /devices/register\n\nRegister device for push notifications:\n\n```json\n{\n  \"device_id\": \"abc123\",\n  \"platform\": \"ios\",\n  \"push_token\": \"apns_token_here\",\n  \"app_version\": \"2.1.0\"\n}\n```\n\n### Notification Types\n\n- `comment_added`: Someone commented on a document\n- `document_shared`: Document shared with user\n- `mention`: User mentioned in a document or comment\n- `sync_complete`: Background sync finished\n\n## User Profile\n\n### GET /users/me\n\nGet current user profile:\n\n```http\nGET /users/me\nAuthorization: Bearer {access_token}\n```\n\nResponse:\n```json\n{\n  \"id\": \"user_123\",\n  \"name\": \"John Doe\",\n  \"email\": \"user@example.com\",\n  \"avatar_url\": \"https://cdn.example.com/avatars/user_123.jpg\",\n  \"preferences\": {\n    \"theme\": \"dark\",\n    \"notifications\": {\n      \"email\": true,\n      \"push\": true,\n      \"comments\": true\n    }\n  }\n}\n```\n\n### PATCH /users/me\n\nUpdate user preferences:\n\n```json\n{\n  \"preferences\": {\n    \"theme\": \"light\"\n  }\n}\n```\n\n## Documents\n\n### GET /documents\n\nList user's documents with pagination:\n\n```http\nGET /documents?limit=20&offset=0&sort=updatedAt\nAuthorization: Bearer {access_token}\n```\n\n### GET /documents/:id\n\nGet full document with content:\n\n```http\nGET /documents/doc_123\nAuthorization: Bearer {access_token}\n```\n\n### POST /documents\n\nCreate new document:\n\n```json\n{\n  \"title\": \"Meeting Notes\",\n  \"content\": \"# Meeting Notes\\n\\nDiscussed...\",\n  \"collection_id\": \"col_456\"\n}\n```\n\n## Error Handling\n\n### Error Response Format\n\n```json\n{\n  \"error\": {\n    \"code\": \"invalid_credentials\",\n    \"message\": \"Email or password is incorrect\",\n    \"details\": {\n      \"field\": \"password\"\n    }\n  }\n}\n```\n\n### Common Error Codes\n\n- `unauthorized`: Invalid or expired token\n- `rate_limited`: Too many requests\n- `not_found`: Resource doesn't exist\n- `validation_error`: Invalid request data\n- `server_error`: Internal server error\n\n## Rate Limiting\n\nMobile API enforces rate limits per device:\n\n- Auth endpoints: 10 requests/minute\n- Data endpoints: 60 requests/minute\n- Sync endpoints: 20 requests/minute\n\nRate limit headers:\n```http\nX-RateLimit-Limit: 60\nX-RateLimit-Remaining: 45\nX-RateLimit-Reset: 1705752000\n```\n\n## Offline Support\n\nThe mobile app implements offline-first architecture:\n\n1. All API responses cached locally\n2. User actions queued when offline\n3. Queue processed when connectivity restored\n4. Conflict resolution for simultaneous edits\n\n### Conflict Resolution\n\nWhen conflicts occur:\n- Last-write-wins for simple fields\n- Operational transformation for document content\n- User prompted to review conflicts for critical data\n\n## SDK Examples\n\n### iOS (Swift)\n\n```swift\nimport Foundation\n\nclass APIClient {\n    let baseURL = \"https://api.mobile.example.com/v2\"\n\n    func login(email: String, password: String) async throws -> AuthResponse {\n        let url = URL(string: \"\\(baseURL)/auth/login\")!\n        var request = URLRequest(url: url)\n        request.httpMethod = \"POST\"\n        request.setValue(\"application/json\", forHTTPHeaderField: \"Content-Type\")\n\n        let body = [\"email\": email, \"password\": password]\n        request.httpBody = try JSONEncoder().encode(body)\n\n        let (data, _) = try await URLSession.shared.data(for: request)\n        return try JSONDecoder().decode(AuthResponse.self, from: data)\n    }\n}\n```\n\n### Android (Kotlin)\n\n```kotlin\nimport okhttp3.*\nimport com.google.gson.Gson\n\nclass APIClient {\n    private val baseURL = \"https://api.mobile.example.com/v2\"\n    private val client = OkHttpClient()\n    private val gson = Gson()\n\n    fun login(email: String, password: String): AuthResponse {\n        val json = gson.toJson(mapOf(\"email\" to email, \"password\" to password))\n        val body = RequestBody.create(MediaType.parse(\"application/json\"), json)\n\n        val request = Request.Builder()\n            .url(\"$baseURL/auth/login\")\n            .post(body)\n            .build()\n\n        val response = client.newCall(request).execute()\n        return gson.fromJson(response.body()?.string(), AuthResponse::class.java)\n    }\n}\n```\n\n## Testing\n\n### Test Credentials\n\nStaging environment test users:\n```\nemail: test@example.com\npassword: test123\n```\n\n### Mock Server\n\nUse our mock server for local development:\n```bash\nnpm install -g @example/mobile-api-mock\nmobile-api-mock --port 3000\n```\n\n## Support\n\nFor API issues:\n- Email: mobile-api@example.com\n- Slack: #mobile-api-support\n- On-call: Check PagerDuty rotation\n\n## Changelog\n\n### v2.1 (2024-01-15)\n- Added device registration endpoint\n- Improved sync conflict resolution\n- Added rate limit headers\n\n### v2.0 (2023-12-01)\n- Complete API redesign\n- OAuth 2.0 authentication\n- Delta sync implementation\n\n---\n\n**Maintained by**: Mobile Team\n**Last Updated**: January 20, 2024",
  "createdAt": "2024-01-20T08:00:00Z",
  "updatedAt": "2024-01-20T15:30:00Z",
  "publishedAt": "2024-01-20T09:00:00Z"
}
