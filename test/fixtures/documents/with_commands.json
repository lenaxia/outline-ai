{
  "id": "doc-with-commands-001",
  "collectionId": "col-inbox-001",
  "title": "API Design Guidelines - DRAFT",
  "text": "# API Design Guidelines - DRAFT\n\n/ai-file engineering related\n\n## Introduction\n\nThis document establishes our standards for designing REST APIs. Following these guidelines ensures consistency, usability, and maintainability across all our API endpoints.\n\n/ai What is our current API rate limiting policy?\n\n## Core Principles\n\n### 1. RESTful Resource Design\n\nUse nouns for resources, not verbs:\n\n**Good**:\n```\nGET /users/123\nPOST /documents\nDELET /comments/456\n```\n\n**Bad**:\n```\nGET /getUser?id=123\nPOST /createDocument\nPOST /deleteComment?id=456\n```\n\n### 2. HTTP Methods\n\nUse appropriate HTTP methods:\n\n- **GET**: Retrieve resources (idempotent, no side effects)\n- **POST**: Create new resources\n- **PUT**: Replace entire resource\n- **PATCH**: Partial update of resource\n- **DELETE**: Remove resource\n\n### 3. Status Codes\n\nReturn meaningful HTTP status codes:\n\n- **2xx Success**\n  - 200 OK: Successful GET, PUT, PATCH\n  - 201 Created: Successful POST\n  - 204 No Content: Successful DELETE\n\n- **4xx Client Errors**\n  - 400 Bad Request: Invalid request data\n  - 401 Unauthorized: Missing or invalid authentication\n  - 403 Forbidden: Valid auth but insufficient permissions\n  - 404 Not Found: Resource doesn't exist\n  - 429 Too Many Requests: Rate limit exceeded\n\n- **5xx Server Errors**\n  - 500 Internal Server Error: Unexpected server error\n  - 503 Service Unavailable: Temporary outage\n\n### 4. Error Responses\n\nProvide consistent error format:\n\n```json\n{\n  \"error\": {\n    \"code\": \"validation_failed\",\n    \"message\": \"Invalid email address\",\n    \"field\": \"email\",\n    \"details\": {\n      \"provided\": \"not-an-email\",\n      \"expected_format\": \"user@domain.com\"\n    }\n  }\n}\n```\n\n## Naming Conventions\n\n### Resource Names\n\n- Use **plural nouns**: `/users`, `/documents`, `/comments`\n- Use **kebab-case** for multi-word resources: `/user-preferences`, `/api-keys`\n- Keep URLs **lowercase**\n\n### Query Parameters\n\n- Use **snake_case**: `?created_after=2024-01-01&sort_by=name`\n- Be **descriptive**: `?include_archived=true` not `?archived=1`\n\n### Field Names (JSON)\n\n- Use **camelCase** in request/response bodies:\n```json\n{\n  \"userId\": 123,\n  \"firstName\": \"John\",\n  \"createdAt\": \"2024-01-20T10:00:00Z\"\n}\n```\n\n## Versioning\n\n### URL-Based Versioning (Preferred)\n\n```\nhttps://api.example.com/v1/users\nhttps://api.example.com/v2/users\n```\n\n**Pros**:\n- Clear and explicit\n- Easy to route in load balancers\n- Simple to understand\n\n**When to version**:\n- Breaking changes to request/response format\n- Removal of fields or endpoints\n- Changes to authentication mechanism\n\n**Backward compatibility**:\n- Add new optional fields (non-breaking)\n- Deprecation warnings for 6 months before removal\n- Maintain old versions for 12 months minimum\n\n## Authentication\n\n### Bearer Token (Preferred)\n\n```http\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIs...\n```\n\n### API Key (Alternative)\n\n```http\nX-API-Key: your-api-key-here\n```\n\n**Best practices**:\n- Always use HTTPS in production\n- Implement token expiration and refresh\n- Rate limit by token/API key\n- Log authentication failures\n\n## Pagination\n\n### Offset-Based (Simple)\n\n```http\nGET /documents?limit=20&offset=40\n```\n\nResponse:\n```json\n{\n  \"data\": [...],\n  \"pagination\": {\n    \"limit\": 20,\n    \"offset\": 40,\n    \"total\": 150\n  }\n}\n```\n\n### Cursor-Based (Large Datasets)\n\n```http\nGET /documents?limit=20&cursor=eyJpZCI6MTIzfQ\n```\n\nResponse:\n```json\n{\n  \"data\": [...],\n  \"pagination\": {\n    \"next_cursor\": \"eyJpZCI6MTQzfQ\",\n    \"has_more\": true\n  }\n}\n```\n\n## Filtering and Sorting\n\n### Filtering\n\n```http\nGET /users?status=active&role=admin&created_after=2024-01-01\n```\n\n### Sorting\n\n```http\nGET /users?sort_by=created_at&order=desc\n```\n\nMultiple fields:\n```http\nGET /users?sort_by=last_name,first_name&order=asc,asc\n```\n\n### Field Selection\n\n```http\nGET /users?fields=id,name,email\n```\n\nReduces response size and improves performance.\n\n## Rate Limiting\n\nImplement rate limits to prevent abuse:\n\n```http\nHTTP/1.1 429 Too Many Requests\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1705752000\nRetry-After: 60\n```\n\n**Tiered limits**:\n- Anonymous: 10 requests/minute\n- Authenticated: 100 requests/minute\n- Premium: 1000 requests/minute\n\n## Webhooks\n\nFor real-time notifications, provide webhooks:\n\n```json\n{\n  \"event\": \"document.created\",\n  \"timestamp\": \"2024-01-20T10:30:00Z\",\n  \"data\": {\n    \"id\": \"doc_123\",\n    \"title\": \"New Document\",\n    \"author_id\": \"user_456\"\n  }\n}\n```\n\n**Security**:\n- Sign webhook payloads with HMAC\n- Verify signatures on receipt\n- Implement retry logic for failed deliveries\n\n## Documentation\n\n### OpenAPI/Swagger\n\nMaintain OpenAPI 3.0 specification:\n\n```yaml\nopenapi: 3.0.0\ninfo:\n  title: Example API\n  version: 1.0.0\npaths:\n  /users:\n    get:\n      summary: List users\n      parameters:\n        - name: limit\n          in: query\n          schema:\n            type: integer\n            default: 20\n```\n\n### Interactive Documentation\n\nProvide:\n- **Swagger UI** for interactive API exploration\n- **Code examples** in multiple languages\n- **Postman collection** for easy testing\n- **Quick start guide** for common use cases\n\n/summarize\n\n## Testing\n\n### Contract Testing\n\nUse tools like Pact to ensure API contracts:\n\n```javascript\nconst { pact } = require('@pact-foundation/pact');\n\ndescribe('User API', () => {\n  it('returns user by ID', async () => {\n    await provider.addInteraction({\n      state: 'user 123 exists',\n      uponReceiving: 'a request for user 123',\n      withRequest: {\n        method: 'GET',\n        path: '/users/123'\n      },\n      willRespondWith: {\n        status: 200,\n        body: {\n          id: 123,\n          name: 'John Doe'\n        }\n      }\n    });\n  });\n});\n```\n\n## Deprecation\n\n### Process\n\n1. **Announce**: 6 months before removal\n2. **Add headers**: `Deprecation: true`, `Sunset: 2024-07-01`\n3. **Update docs**: Mark as deprecated\n4. **Monitor usage**: Track who's still using deprecated endpoints\n5. **Remove**: After sunset date\n\n### Communication\n\n```http\nHTTP/1.1 200 OK\nDeprecation: true\nSunset: Sat, 01 Jul 2024 00:00:00 GMT\nLink: </v2/users>; rel=\"successor-version\"\n```\n\n## Performance\n\n### Caching\n\nImplement HTTP caching:\n\n```http\nCache-Control: public, max-age=3600\nETag: \"33a64df551425fcc55e4d42a148795d9f25f89d4\"\nLast-Modified: Wed, 20 Jan 2024 10:00:00 GMT\n```\n\n### Compression\n\nEnable gzip compression:\n\n```http\nAccept-Encoding: gzip, deflate\nContent-Encoding: gzip\n```\n\n### Batch Operations\n\nSupport batch requests to reduce round trips:\n\n```http\nPOST /batch\n\n{\n  \"operations\": [\n    {\"method\": \"GET\", \"path\": \"/users/123\"},\n    {\"method\": \"GET\", \"path\": \"/users/456\"},\n    {\"method\": \"POST\", \"path\": \"/documents\", \"body\": {...}}\n  ]\n}\n```\n\n## Security\n\n### Input Validation\n\n- Validate all inputs server-side\n- Use schema validation (JSON Schema)\n- Sanitize user-provided data\n- Implement rate limiting\n\n### CORS\n\nConfigure CORS properly:\n\n```http\nAccess-Control-Allow-Origin: https://app.example.com\nAccess-Control-Allow-Methods: GET, POST, PUT, DELETE\nAccess-Control-Allow-Headers: Authorization, Content-Type\nAccess-Control-Max-Age: 86400\n```\n\n### HTTPS Only\n\n- Redirect HTTP to HTTPS\n- Use HSTS headers\n- Keep TLS certificates up to date\n\n## Monitoring\n\n### Metrics\n\nTrack:\n- Request volume and latency\n- Error rates by endpoint\n- Rate limit hits\n- Authentication failures\n- Response times (p50, p95, p99)\n\n### Logging\n\nLog:\n- All API requests (excluding sensitive data)\n- Authentication events\n- Rate limit violations\n- Errors with context\n\n## References\n\n- [REST API Best Practices](https://restfulapi.net/)\n- [HTTP Status Codes](https://httpstatuses.com/)\n- [OpenAPI Specification](https://swagger.io/specification/)\n- [API Security Checklist](https://github.com/shieldfy/API-Security-Checklist)\n\n---\n\n**Status**: Draft - needs review\n**Owners**: Platform Team\n**Last Updated**: January 20, 2024",
  "createdAt": "2024-01-20T09:00:00Z",
  "updatedAt": "2024-01-20T14:30:00Z",
  "publishedAt": null
}
